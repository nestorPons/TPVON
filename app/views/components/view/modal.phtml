<!-- <label for="control_<?=$id?>"></label> -->
<input type="checkbox" id="control_<?=$id?>" class="modal">
<div>
  <div class="card card-modal" id="<?=$idElement?>">
    <label for="control_<?=$id?>" class="modal-close" ></label>
    <h1 id="tileModal<?=$idElement?>"></h1>
    <?php include($body)?>
  </div>
</div>
  <style>
  #<?=$idElement?>{
      overflow: inherit;
      padding: 1rem;
  }
  #<?=$idElement?>  .modal-close{
    top: -1em;
    background-color: inherit;
    right: -1em;
    border-radius: 25px;
    padding: 0;
    border: 1px solid var(--border-color);

  }
  #<?=$idElement?> label.modal-close:hover:before{
    color: var(--input-invalid-color) ;
  }
  </style>
  <script>
  var Modal = class{
    constructor(id){
      this.el = document.getElementById('<?=$idElement?>')
      this.$el = $('#<?=$idElement?>')
      this.$switch = $('#control_' + id)
      this.$el.keyup(e => (e.key === 'Escape') && this.hide())
    }
    clear(){
      this.$el.find('form').trigger('reset')
      return this
    }
    setTile(tile){
      $('#tileModal<?=$idElement?>').html(tile)
      return this
    }
    show(data = null){
      if(data) this.load(data)
      this.$switch.prop('checked',true)
      this.$el.find('[tabindex=1]').focus()
      return this
    }
    hide(){
      this.$switch.prop('checked',false)
      return this
    }
    load(data){
      const inputs = this.$el.find('input'),
            selects = this.$el.find('select')

      selects.each(function(){
  
        $(this).find('[selected]').attr('selected',false)
        if(data.id != -1)
          $(this)
            .find('option[value="'+data[$(this).attr('name')]+'"]').attr('selected', true)    
        else
          $(this)
            .find('[default]').attr('selected',true)
        

      })
      inputs.each(function(){
        if($(this).attr('type') == 'checkbox' || $(this).attr('type') == 'radio')
          data[$(this).attr('name')] == 1 && $(this).prop('checked', true)  
        else $(this).val(data[$(this).attr('name')])
      })
      return this
    }
    getData(){ 
      return app.formToObject(this.el)
    }
  }
  </script>