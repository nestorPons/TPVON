<?php namespace app\views\components\controllers;?>
<section id="users">
    <?php
    $table = new Table(['columns'=>['id', 'Nombre', 'Tel', 'Email'], 
        'class'=>'hoverable', 'onclick'=>'users.show(window.event)']);
    $editUser = new Modal(['body'=> \VIEWS\ADMIN\SECTIONS . 'users/edit.phtml'], false);
    ?>

</section>
<script>
'use strict'
var users = {
    table: 'usuarios',
    buttons: ['add', 'del', 'search'],
    currentId: null, 
    Table: new Table('<?=$table->idEl()?>'),
    Form : new Modal('<?=$editUser->id()?>'),
    validation(){
        let data = this.Form.getData()
        return  app.data.get(this.table,'dni', data.dni) == false
    },
    save(){ 
        let data = this.Form.getData()
        app.data.set(this.table, data , 'id', this.currentId)

        this.Table.updateLine(this.currentId, [this.currentId, data.nombre, data.tel, data.email])
        this.Form.hide()
        
    },
    loadData(){
        
    },
    load(){
        let users  = app.data.get(this.table)
        for( i in users ){
            var user = users[i]
            this.Table.addLine(
                user.id, 
                [user.id, user.nombre, user.tel, user.email]
            )
        }
    },
    show(e){
        this.currentId = e.path[1].attributes.idline.value
        let data = app.data.get(this.table, 'id', this.currentId)
        this.Form.show(data)
    }
}
</script>
<style>
    #users #<?=$table->id()?>{
        max-height: 80vh ;
    }
</style>