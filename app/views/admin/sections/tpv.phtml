<?php use app\views\components\controllers \ {
    InputText,
    InputSearch,
    ButtonSuccess,
    Table
}; ?>
<section id="tpv">

        <?php
        $table = new Table(['columns'=>['C贸digo', 'Descripci贸n', 'Cantidad', 'Precio', 'Dto', 'Importe']]);
        $id = new InputText(['value' => $tickets_id, 'label' => 'Id'],  false);
        $hour = new InputText(['value' => $tickets_hora, 'label' => 'Hora'],  false);
        $code = new InputSearch(['label' => 'Codigo', 'name' => 'servicio', 'required' => true, 'options' => $Services->get('codigo'), 'tabindex'=>1], false);
        $des = new InputText(['label' => 'Desctipcion','tabindex'=>2],  false);
        $emp = new InputSearch(['label' => 'Operador', 'required' => true, 'options' => $Employees->get('nombre')], false);
        $cli = new InputSearch(['label' => 'Cliente', 'options' => $Users->get('nombre')], false);
        $quan = new InputText(['label' => 'Cantidad', 'tabindex'=>3], false);
        $pric = new InputText(['label' => 'Precio', 'tabindex'=>4], false);
        $dto = new InputText(['label' => 'Dto', 'tabindex'=>5], false);
        $amo = new InputText(['id' => 'amount', 'label' => 'Importe', 'disabled' => true], false);
        $add = new ButtonSuccess(['tabindex'=>6]);
        ?> 
</section> 
<style>
    #tpv{
        align-items: flex-start;
        display: grid;
        grid-template-rows: auto [table] 400px auto auto;
        grid-template-columns: 10rem 1fr 1fr 4rem 6rem 4rem  [last] 6rem;
    }
    #tpv table:not(.horizontal) thead{
        height: 60px;
    }
    #tpv * {
        font-size: 0.8rem;
    }
    #tpv table{
        grid-row: table;
        grid-column: 1/-1;
    }
    #tpv #<?= $id->id() ?>{
        grid-area: 1/1;
    }
    #tpv #<?= $add->id() ?>{
        grid-row: 4;
        grid-column: last;
    }
    #tpv #<?= $hour->id() ?>{
        grid-row: 1;
        grid-column: last;
    }
    #tpv #<?= $code->id() ?>{
        grid-area: 3/1;
    }
    #tpv #<?= $des->id() ?>{
        grid-row: 3;
        grid-column: 2 / span 2;
    }
    #tpv #<?= $emp->id() ?>{
        grid-area: 1/2;
    }
    #tpv #<?= $cli->id() ?>{
        grid-area: 1/3;
    }
    #tpv #<?= $quan->id() ?>{
        grid-area: 3/4;
    }
    #tpv #<?= $pric->id() ?>{
        grid-area: 3/5;
    }
    #tpv #<?= $dto->id() ?>{
        grid-area: 3/6;
    }
    #tpv #<?= $amo->id() ?>{
        grid-row: 3;
        grid-column: last;
    }
    #tpv .Importe{
        text-align: right;
    }
</style>
<script src="js/Line.min.js"></script>
<script src="js/Ticket.min.js"></script>
<script>
var ticket = new Ticket(); 

$('#<?=$add->id()?>').click(function(){

    const 
        $template = $( $('#template_<?=$table->id()?>')[0].innerHTML ),
        $table = $('#<?=$table->id()?>'), 
        $code =  $('#input_<?=$code->id()?>'),
        $des = $('#input_<?=$des->id()?>'),
        $emp = $('#input_<?=$emp->id()?>'),
        $quan = $('#input_<?=$quan->id()?>'),
        $price = $('#input_<?=$pric->id()?>'),
        $dto = $('#input_<?=$dto->id()?>')

    var line = ticket.addLine($code.val(), $des.val(), $quan.val(), $price.val(), $dto.val(), $quan.val())
    if(line.success){
        $template
            .attr('id', line.id)
            .find('.C贸digo').html(line.cod).end()
            .find('.Descripci贸n').html(line.des).end()
            .find('.Cantidad').html(line.qua).end()
            .find('.Precio').html(line.pri).end()
            .find('.Dto').html(line.dto).end()
            .find('.Importe').html(line.amount()).end()
    
        $table.append($template) 
    }

})

</script>